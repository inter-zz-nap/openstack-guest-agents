#!/bin/sh

prefix="@prefix@"
exec_prefix="@exec_prefix@"
sbindir="@sbindir@"
datadir="@datarootdir@/@PACKAGE@"
dataversdir="@datarootdir@/@PACKAGE@/@PACKAGE_VERSION@"
version="@PACKAGE_VERSION@"

umask 077

my_dir=`dirname $0`

if [ -d $dataversdir ] ; then
	# This version is already installed
	echo "Version ${version} is already installed"
	exit 1
fi

if [ ! -d $datadir ] ; then
    mkdir $datadir
fi

# Copy our version subdirectory to the target
cp -R ${my_dir}/${dataversdir} ${dataversdir}

# Install the init file symlink
rm -f /etc/init.d/nova-agent
ln -s ${dataversdir}/etc/nova-agent.init /etc/init.d/nova-agent

# Install the new nova-agent symlink
rm -f ${sbindir}/nova-agent
ln -s ${dataversdir}/sbin/nova-agent ${sbindir}/nova-agent 

# Install the new nova-agent config file symlink
rm -f ${datadir}/nova-agent.py
ln -s ${dataversdir}/nova-agent.py ${datadir}/nova-agent.py

# Remove the old agent if it exists
if [ -f /usr/sbin/agent-smith ] ; then
    rm -f /usr/sbin/agent-smith
    rm -rf /usr/share/agent-smith
    rm -f /var/log/agent-smith.log
fi

# Restart (or start) the agent
#sh /etc/init.d/nova-agent restart

exit 0
